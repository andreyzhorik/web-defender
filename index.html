<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Web Defender</title>
  <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  <style>
    :root{
      --bg:#0b0b11;
      --panel:#1a1a25;
      --accent:#00b7ff;
      --muted:#2a2a38;
      --text:#fff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      flex-direction:column;
      background:var(--bg);
      color:var(--text);
      font-family:Inter, system-ui, Arial, sans-serif;
      padding:28px;
    }

    h1{font-size:1.6rem;margin:0 0 6px 0;font-weight:600}

    .input-row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    input[type="text"]{
      width:320px;
      max-width:70vw;
      padding:12px 14px;
      border-radius:10px;
      border:0;
      background:var(--panel);
      color:var(--text);
      font-size:15px;
      outline:none;
    }
    button.btn{
      background:var(--accent);
      color:#fff;
      border:0;
      padding:11px 16px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      transition:transform .12s ease, background .12s;
    }
    button.btn:hover{ transform:scale(1.04); background:#0093cc; }

    .shortcuts{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      max-width:780px;
      width:100%;
    }

    .tile{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      min-width:110px;
      padding:14px 18px;
      border-radius:12px;
      background:var(--panel);
      color:var(--text);
      font-weight:700;
      cursor:pointer;
      user-select:none;
      transition:transform .14s ease, background .14s;
    }
    .tile:hover{ transform:scale(1.04); background:var(--accent); color:#000 }

    .remove-btn{
      position:absolute;
      top:20px;
      left:6px;
      width:16px;
      height:16px;
      padding:0;
      border-radius:50%;
      border:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
      line-height:1;
      background:rgba(255,255,255,0.12);
      color:var(--text);
      cursor:pointer;
      opacity:0;
      transform:scale(.98);
      transition:opacity .14s ease, transform .14s ease, background .12s;
    }
    .tile:hover .remove-btn{ opacity:1; transform:scale(1); }
    .remove-btn:hover{ background:rgba(255,60,60,0.9); transform:scale(1.08) }

    .add-tile{
      border:2px dashed var(--accent);
      background:transparent;
      color:var(--accent);
      min-width:110px;
    }

    .controls{
      display:flex;
      gap:12px;
      align-items:center;
      margin-top:6px;
    }

    .switch{ position:relative; width:50px; height:26px; display:inline-block;}
    .switch input{ display:none; }
    .switch .track{
      position:absolute; inset:0; border-radius:999px; background:#444; transition:background .18s;
      display:flex;
      align-items:center;
    }
    .switch .knob{
      position:absolute; left:3px; top:3px; width:20px; height:20px; border-radius:50%; background:#fff; transition:transform .18s;
    }
    .switch input:checked + .track{ background:var(--accent); }
    .switch input:checked + .track > .knob{ transform:translateX(24px); }

    .muted{ color:#9aa2af; font-size:13px }

    .inspect-btn {
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 1000;
      background: var(--muted);
      color: var(--text);
      border: 0;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: transform .12s ease, background .12s;
    }
    .inspect-btn:hover {
      transform: scale(1.05);
      background: var(--accent);
      color: #000;
    }
    .eruda-entry-btn { display:none }
  </style>
</head>
<body>
  <button id="inspectBtn" class="inspect-btn">Inspect</button>

  <h1>Web Defender</h1>

  <div class="input-row">
    <input id="urlInput" type="text" placeholder="Enter URL (https://...)" />
    <button id="openBtn" class="btn">Open</button>
    <div class="controls">
      <label class="muted">Open in new tab</label>
      <label class="switch">
        <input id="newTabSwitch" type="checkbox" checked>
        <span class="track"><span class="knob"></span></span>
      </label>
    </div>
  </div>

  <div class="shortcuts" id="shortcuts"></div>

  <script>
    const KEY = 'webDefenderShortcuts_v2';
    const defaultShortcuts = [
      { name: 'SoundBoard', url: 'https://soundboardw.com' },
      { name: 'EmojiCombos', url: 'https://emojicombos.com' },
    ];

    function readStore(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw){
          localStorage.setItem(KEY, JSON.stringify(defaultShortcuts));
          return [...defaultShortcuts];
        }
        return JSON.parse(raw) || [];
      }catch(e){ return [...defaultShortcuts]; }
    }
    function writeStore(arr){
      localStorage.setItem(KEY, JSON.stringify(arr));
    }

    const shortcutsWrap = document.getElementById('shortcuts');
    const newTabSwitch = document.getElementById('newTabSwitch');
    const urlInput = document.getElementById('urlInput');
    const openBtn = document.getElementById('openBtn');

    function buildTile(item){
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.title = item.url;
      tile.textContent = item.name;

      const rb = document.createElement('button');
      rb.className = 'remove-btn';
      rb.innerHTML = '×';

      rb.addEventListener('click', ev => {
        ev.stopPropagation();
        const cur = readStore();
        writeStore(cur.filter(s => !(s.name===item.name && s.url===item.url)));
        renderShortcuts();
      });

      tile.addEventListener('click', ev => {
        if(ev.target === rb) return;
        openSecured(item.url);
      });

      tile.appendChild(rb);
      return tile;
    }

    function renderShortcuts(){
      shortcutsWrap.innerHTML = '';
      readStore().forEach(it => shortcutsWrap.appendChild(buildTile(it)));

      const add = document.createElement('div');
      add.className = 'tile add-tile';
      add.textContent = '+ Add';
      add.addEventListener('click', () => {
        const name = prompt('Shortcut name:');
        if(!name) return;
        const url = prompt('URL (https://...)');
        if(!url || !/^https?:\/\//i.test(url)){ alert('Invalid URL'); return; }
        const cur = readStore();
        cur.push({name:name.trim(), url:url.trim()});
        writeStore(cur);
        renderShortcuts();
      });
      shortcutsWrap.appendChild(add);
    }

    function openSecured(url){
      if(!/^https?:\/\//i.test(url)){ alert('Invalid URL'); return; }

      if(newTabSwitch.checked){
        const w = window.open('about:blank', '_blank');
        if(!w){ alert('Enable pop-ups'); return; }
        writeSecuredDoc(w.document, url);
      } else {
        const doc = document.open();
        writeSecuredDoc(doc, url);
      }
    }

    function writeSecuredDoc(targetDoc, url){
      const safeUrl = String(url).replace(/<\/script>/gi, '<\\/script>');

      const html =
`<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Website Secured</title>

    <!-- Add Eruda to SECURED PAGE -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>

    <style>
      html,body{height:100%;margin:0;background:#0b0b11}
      iframe{width:100%;height:100%;border:0}
      .bar{
        position:fixed;left:8px;top:8px;z-index:9999;
        padding:8px 10px;border-radius:10px;
        background:rgba(0,0,0,0.45);color:#fff;font-family:Inter,Arial
      }
      .btn{
        background:#00b7ff;color:#000;padding:6px 8px;
        border-radius:8px;border:0;font-weight:700;cursor:pointer
      }

      /* floating inspect button inside secured page */
      #inspectInside{
        position:fixed;top:60px;left:12px;z-index:9999;
        padding:8px 12px;border-radius:8px;
        background:#2a2a38;color:#fff;border:0;
        font-weight:700;cursor:pointer;
      }
      #inspectInside:hover{
        background:#00b7ff;color:#000;
      }
    </style>
  </head>
  <body>

    <div class="bar">
      Web Defender — opened: ${safeUrl}
      <button class="btn" id="openNew">Open in new tab</button>
    </div>

    <button id="inspectInside">Inspect</button>

    <iframe src="${safeUrl}" id="wd-frame"></iframe>

    <script>
      function beforeUnloadHandler(e){
        var msg='You have unsaved changes — leave?';
        e=e||window.event;
        if(e) e.returnValue=msg;
        return msg;
      }
      window.onbeforeunload=beforeUnloadHandler;
      window.addEventListener('beforeunload', beforeUnloadHandler);

      document.getElementById('openNew')
        .addEventListener('click',()=>window.open('${safeUrl}','_blank'));

      // Init Eruda inside SECURED PAGE
      eruda.init();
      eruda.hide();

      // floating button toggle
      document.getElementById('inspectInside').addEventListener('click',()=>{
        if(eruda._isShow) eruda.hide();
        else eruda.show();
      });
    <\/script>

  </body>
</html>`;

      targetDoc.write(html);
      targetDoc.close();
    }

    openBtn.addEventListener('click', () => {
      const url = urlInput.value.trim();
      if(!url){ alert('Enter URL'); return; }
      openSecured(url);
    });

    if(window.eruda){
      eruda.init();
      eruda.hide();
      document.getElementById('inspectBtn')
        .addEventListener('click',()=>eruda.show());
    } else {
      document.getElementById('inspectBtn').style.display='none';
    }

    renderShortcuts();
  </script>
</body>
</html>
